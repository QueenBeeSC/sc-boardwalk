<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../sc-web3/sc-web3.html">
<link rel="import" href="../sc-wallet/sc-wallet.html">
<link rel="import" href="../sc-vault/sc-vault.html">
<link rel="import" href="../sc-intro/sc-intro.html">
<!-- <link rel="import" href="../sc-newdeal/sc-newdeal.html"> -->

<!--
`sc-boardwalk-app`


-->
<dom-module id="sc-boardwalk-app">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

   <!--  <app-location route="{{route}}" use-hash-as-path></app-location> -->
    <app-route route="[[route]]" pattern="/:page" data="{{routedata}}" tail="{{pageTail}}"></app-route>
   

 <!-- <app-route route="[[route]]" pattern="/:page" data="{{routedata}}" tail="{{pageTail}}"></app-route> -->
    <sc-web3 id="web3" web3="{{web3}}" keystore="[[keystore]]"></sc-web3>
    <sc-wallet
        id="wallet"
        web3="[[web3]]"
        pubkey="[[account]]"
        updating="{{balanceupdating}}"
        arcbalance="{{arcbalance}}"
        swtbalance="{{swtbalance}}"
        ethbalance="{{ethbalance}}"
        status="{{walletstatus}}"
        lowgas="{{lowgas}}"
        emptygas="{{emptygas}}"
        on-ready="checkready"
        >
    </sc-wallet>

  <neon-animated-pages attr-for-selected="data-page" selected="[[routedata.page]]">

   <!--  <sc-loadview
        data-page="loading"
        msg="">
    </sc-loadview> -->
<!-- 
    <sc-swtconversion
      data-page="swt"
      id="swt"
      route="[[pageTail]]"
      keystore="[[keystore]]"
      web3="[[web3]]"
      account="[[account]]"
      on-exit="logout"
      on-success="toHome"
      on-converted="converted"
      >
    </sc-swtconversion> -->

    <sc-intro
      id="intro"
      data-page="intro"
      on-newvault="intro_createNewVault"
      on-importfile="intro_toimportfile"
      on-importethwallet="intro_toimportethwallet"
      on-importpk="intro_toimportpk"
      on-externalpk="intro_toexternalpk"
      on-vaultlocked="intro_toUnlockVault"
      on-enter="enter"
      on-exit="intro_toAppStart"
      on-restoreipfs="intro_torestoreipfs"
      route="[[pageTail]]"
      vaultstatus="[[vaultstatus]]"
      >
    </sc-intro>

    <sc-vault
      id="vault"
      data-page="vault"
      route="[[pageTail]]"
      currentkeystore="{{keystore}}"
      currentidentity="{{identity}}"
      currentaccount="{{account}}"
      lastbackup="{{lastbackup}}"
      on-ready="checkready"
      status="{{vaultstatus}}"
      on-backupexit="toProfile"
      on-exit="intro_toAppStart"
      >
    </sc-vault>
<!-- 
    <sc-home
      id="home"
      data-page="home"
      keystore="[[keystore]]"
      identity="[[identity]]"
      lastbackup=[[lastbackup]]
      web3="[[web3]]"
      pubkey="[[account]]"
      swtbalance="[[swtbalance]]"
      ethbalance="[[ethbalance]]"
      balanceupdating="[[balanceupdating]]"
      on-to-profile="toProfile"
      on-to-walletview="toWalletview"
      >
    </sc-home> -->

<!-- 
    <sc-profile
      data-page="profile"
      id="profile"
      identity="[[identity]]"
      lastbackup=[[lastbackup]]
      pubkey="[[account]]"
      on-exit="toHome"
      on-identity-update="saveIdentity"
      on-backup="toBackup"
      on-logout="logout"
      on-deletevault="deletevault"
      >
    </sc-profile> -->
<!-- 
    <sc-walletview
      data-page="walletview"
      id="walletview"
      web3="[[web3]]"
      keystore="[[keystore]]"
      identity="[[identity]]"
      account="[[account]]"
      lowgas="[[lowgas]]"
      emptygas="[[emptygas]]"
      on-exit="toHome"
      on-refreshneeded="refreshwallet"
      updating="[[balanceupdating]]"
      swtbalance="[[swtbalance]]">
    </sc-walletview> -->
 </neon-animated-pages>

  </template>

  <script>
    Polymer({

      is: 'sc-boardwalk-app',

      properties: {
        route: {
          type: Object
        },
      },
      
      observers: [
        '_onRouteDataChanged(routedata.page)'
      ],

      ready: function(){
        //this.transitionto('/p1');
      },

      attached: function(){
        //setTimeout(function(){
          console.log('sc-boardwalk-app -> loaded');
          this.fire('loaded');
        //}.bind(this),2*1000);
      },
      onEnter: function(){
        console.log('sc-boardwalk -> onEnter');
        this.transitionto('/p1');        
      },
      onExit: function(){
        console.log('sc-boardwalk -> onExit');
        this.transitionto('/');
      },

      exit: function() {
        this.fire('exit');
      },

      checkready: function(){
         return  this.transitionto('/intro/welcome');
      },

      intro_toAppStart: function(){
        this.transitionto('/intro/welcome');
      },
      transitionto: function(target){
        console.log('sc-app -> transitionTo',target);
        this.set('route.path',target);
      },

      _onRouteDataChanged: function(page,oldpage) {
         console.log('sc-app -> _onRouteDataChanged',oldpage,'->',page);
       },

      // intro routing
      intro_createNewVault: function(){
        this.transitionto('/vault/createnew');
      },    

      intro_toimportfile: function(){
        this.transitionto('/vault/importfile');
      },   

      intro_toimportethwallet: function(){
        this.transitionto('/vault/importethwallet');
      },   

      intro_toimportpk: function(){
        this.transitionto('/vault/importpk');
      },

      intro_toexternalpk: function(){
        this.transitionto('/vault/externalpk');
      }, 

      intro_toUnlockVault: function(){
        this.transitionto('/vault/unlock');
      },    

      intro_torestoreipfs: function(){
        this.transitionto('/vault/importipfs');
      },
    });
  </script>
</dom-module>
