<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../sc-web3/sc-web3.html">
<link rel="import" href="../sc-config/sc-config.html">
<link rel="import" href="../sc-helpers/sc-helpers.html">

<!--
`sc-backbone`

This is the component that links the blockchain published config to the app.
Example:
    <sc-backbone></sc-backbone>

-->

<dom-module id="sc-backbone">
  <template>
    <sc-web3 web3="{{web3}}"></sc-web3>  
    <sc-config config="{{config}}"></sc-config>
    <sc-helpers id="helpers"></sc-helpers>
  </template>
  <script>
    Polymer({

      is: 'sc-backbone',

      observers: [
        '_web3(web3)',
        '_configchanged(config)'
      ],    

      ready: function(){
        this.LLQueue = [];
      },

      _web3: function(){
        console.log('Web3 is here...');
        //this.processLLQueue();
      },

      _configchanged: function(){
        // console.log('config loaded - now I will be reading the contract...',this.config.backbonecontractaddress);
        // var self=this;
        // this.loadbackbonecontract(function(){
        //   self.ParametersInstance.getParameter.call('dapp.root',function(a,b){
        //     //console.log('resturned',a,b);
        //     self.processLLQueue();
        //   });  
        // });
        
      },

      // loadbackbonecontract: function(cb){
      //   var self=this;
      //   if (!this.web3 || !this.config){
      //     return;
      //   }
      //   this.$.helpers.getjson('../contracts/Parameters.json', function(err, contractjson) {
      //     var MyContract = self.web3.eth.contract(contractjson.abi);
      //     self.ParametersInstance = MyContract.at(self.config.backbonecontractaddress);
      //     cb();
      //   });      
      // },

      // lazyload: function(name){
      //   this.push('LLQueue',name);
      //   this._lazyLoad(name,'../' + name + '.html');
      //   this.$.helpers.lazyload(elementid, filename, cb)
      // },

      // processLLQueue: function(){
      //   if (this.web3 && this.config && this.LLQueue){
      //     console.log('processing Lazy loading...');
      //   }
      // },

      // _lazyLoad: function(elementid, filename, cb) {


      //   this.$.helpers.lazyload(elementid, filename, cb).bind(this);

        // var t0 = performance.now();
        
        // if (Polymer.isInstance(this.$[elementid])) {
        //   if (cb) {
        //     cb(null,this.$[elementid]);
        //     //} && this.$[elementid][method]) {
        //     //this.$[elementid][method]();
        //   }
        //   return;
        // }
        // var url = this.resolveUrl(filename);

        // Polymer.Base.importHref(
        //   url,
        //   function(e) {
        //     console.log('LAZYLOADER --> ', elementid, 'loaded & added to DOM');
        //     if (cb) {
        //       cb(null,this.$[elementid]);
        //     }
        //     var t1 = performance.now();
        //     console.log('Lazy loading',elementid,'took',(t1 - t0),'milliseconds.');
        //   }.bind(this),
        //   function() {
        //     console.log('Something failed!');
        //   }, true
        // );
      // },      


    });
  </script>
</dom-module>
