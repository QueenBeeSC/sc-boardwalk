<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">

<link rel="import" href="../../bower_components/sc-style/sc-style.html">
<link rel="import" href="../../bower_components/sc-iconset/sc-iconset.html">

<link rel="import" href="../sc-ipfs/sc-ipfs.html">
<link rel="import" href="../sc-avatar/sc-avatar.html">


<!--
`sc-profile` is profile-view where a Swarm Citizen can do his profile-things. Here the user has the possibility of changing his avatar/username, he can view his complete pubkey, or creating a backup of his profile via IPFS. The user can also logout here, or delete his complete user-data from the device.

@demo src/sc-profile/demo/index.html 
-->

<dom-module id="sc-profile">
<link rel="import" href="../../bower_components/sc-style/sc-style.css"  type="css">

  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      neon-animated-pages {
        height: 90vh;
      }


      .profilepic {
        box-sizing: border-box;
        padding: 0px 4vw 0px 10vw;

      }

      .profilepicinner {
        @apply(--layout-vertical);
        @apply(--layout-start-justified);
        @apply(--layout-end);
      }

      .uploadicon {
        z-index: 12;
        margin-top: -20px;
    /*    @apply(--base-structure-and-inset);*/
      }

      .croppiecontrols {
        z-index: 12;
        margin: -70px 0px 20px 0px;
        box-sizing:border-box;    
        padding-left: 10px;
      }

      .croppiecontrols paper-icon-button {
        width: 50px;
        height: 50px;
        margin-bottom: 5px;
      }
      .croppiecontrols p {
        @apply(--montserrat-semibold);

      }

    .warning {
      width: 90%;
      background-color: var(--sc-blue);
      box-sizing:border-box;
      padding: 38px;
      @apply(--layout-vertical);
      @apply(--layout-start);
      @apply(--layout-start-justified);
      margin-bottom: 10vh;
    }

    .warningsign {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 3px solid var(--sc-white);
      opacity: 0.5;
      margin-bottom: 20px;
    }

    .warningsign p {
            font-size: 24px;

    }


    
      @media all and (min-width: 0) and (max-width: 420px) {

      }


    </style>

    <sc-ipfs id="ipfs"></sc-ipfs>

    <div class="total darkerer" id="totalbox">

      <div class="topbar">
        <span class="flex"></span>
        <iron-icon class="grey3" icon="sc-icons:decline" on-tap="exit">back</iron-icon>
      </div>

      <neon-animated-pages selected="{{datastate}}" attr-for-selected="data-state" entry-animation="fade-in-animation" exit-animation="fade-out-animation">
        <neon-animatable data-state="view">
        <div class="totalwidth vertic centercenter view">

          <template is="dom-if" if="{{!lastbackup}}">
            <div class="whitespace"></div>
            <div class="warning">
              <div class="warningsign vertic centercenter"><p class="bold white">!</p></div>
              <p class="white bold youneedto">Did you backup your profile yet?</p>
              <div class="minispace"></div>
              <div class="minispace"></div>
              <p class="white reg">This app is fully decentralized, so there is no central party that keeps your account information. This means that when you remove the user from this device, the only way to recover it is with a backup you have to create. The <span class="bold">backup</span> together with <span class="bold">your password</span> will give you permanent control of your tokens.</p>
              <div class="whitespace"></div>
              <paper-button class="bold shadow white lighter" on-tap="backupvault">Create a backup</paper-button>
              <div class="whitespace"></div>
              <p class="small bold white disapp">This message will disappear when you create your backup.</p>
            </div>
          </template>



            <div class="profilepic vertic centercenter">
              <div class="profilepicinner" on-tap="uploadfile">

              <template is="dom-if" if="{{avatarloading}}">
              <div class="avatarloading">
                <sc-spinner color="blue" small></sc-spinner>
              </div>
              </template>

                <sc-avatar
              id="currentavatar"
              identity="{{identity}}"
              pubkey="{{account}}"
              mode="imgonly"
              size="big"
              ></sc-avatar>
                <input type="file" accept="image/*" class="hidden" id="avatarupload" on-change="avatarChange"/>
                <paper-icon-button icon="sc-icons:upload" class="blueback white uploadicon" id="uploadbtn"></paper-icon-button>
              </div>
            </div>

          </div>
        </neon-animatable>
      </neon-animated-pages>
    </div>

  </template>
  <script>
    Polymer({

      is: 'sc-profile',

      properties: {

        /**
       * `identity` is received from parent-element, as an object containing an IPFS-hash, which is img-source.
       */
        identity: {
          type: String,
          observer: '_identity',
          notify: true
        },

        /**
       * `web3` is received from parent-element.
       */
        web3: {
          type: Object
        },

        /**
       * `keystore` is received from parent-element.
       */
        keystore: {
          type: Object,
           observer: '_keystore',
        },

       //  /**
       // * `datachanged` .
       // */
       //  datachanged: {
       //    type: Boolean,
       //    value: false
       //  },

        /**
       * `sharedElements` is used to share elements between components for doing animations.
       */
        sharedElements: {
          type: Object,
          value: function() {
            return {
              'hero': '',
            }
          }
        },  

        /**
       * `animationConfig` is used to configure animations.
       */
        animationConfig: {
        },


        /**
       * `pubkey` is the Swarm Citizen's pubkey.
       */        
        pubkey: {
          type: String,
          observer: '_pubkey'
        },

      },

      behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior
      ],


      ready: function(){
                this.datastate = 'view';

              },
      /**
      * 'onEnter' are the behaviors that occur when the router tells this component enters the stage 
      * use this to initialize any variables to start the component
      */
      onEnter: function(){
      },

      /**
      * 'onExit' are the behaviors that occur when the router tells this component to leave the stage 
      * use this to reset any variables when leaving this component while it remains loaded.
      */
      onExit: function(){
      },



      /**
      * 'exit' is fired when the x is tapped in sc-profile.
      */
      exit: function(){
      },

      /**
      * '_pubkey' monitors is the pubkey changes to update the balance.
      */
      _pubkey: function(){
        // if (this.pubkey){
        //   this.$.wallet.updateBalance();
        // }
      },

      /**
      * '_identity' monitors is the identity changes.
      */
      _identity: function() {
        if (this.identity){
          this.currentavatar = this.identity.avatarurl;
        }
      },


      /**
      * 'toHashtag' makes the app go to a new view/route (in this case sc-hashtag). The function sets the animationConfig and sharedElements, then fires 'to-hashtag' to the parent-element to change the route.
      */
      toHashtag: function(e) {
        if (this.phoneview) {

          this.sharedElements = {
              'hero': this.$.homeavatar,
              'balance': this.$.homebalance
            };

          this.animationConfig = {
              'entry': [{
                  name: 'fade-in-animation',
                  node:this.$.homebalance,
                  toPage: this,
                  timing: {
                    delay: 200,
                    duration: 125
                  }
                },{
                  name: 'fade-in-animation',
                  node:this.$.homeusername,
                  toPage: this,
                  timing: {
                    delay: 475,
                    duration: 125
                  }
                }, {
                  name: 'slide-from-bottom-animation',
                  node:this.$.bottomhalf,
                  toPage: this,
                  timing: {
                    duration: 700
                  }
                },{
                  name: 'hero-animation',
                  id: 'hero',
                  toPage: this,
                  timing: {
                      duration: 500
                  }
                },{
                  name: 'hero-animation',
                  id: 'balance',
                  toPage: this,
                  timing: {
                      duration: 500
                  }
                }],

                'exit': [
                  {
                    name: 'fade-out-animation',
                    node:this.$.homeusername,
                    fromPage: this,
                    timing: {
                        duration: 200
                    }
                  }, {
                    name: 'fade-out-animation',
                    node:this.$.bottomhalf,
                    fromPage: this,
                    timing: {
                        duration: 200
                    }
                  },{
                    name: 'hero-animation',
                    id: 'hero',
                    fromPage: this,
                    timing: {
                        duration: 500
                    }
                  },{
                    name: 'hero-animation',
                    id: 'balance',
                    fromPage: this,
                    timing: {
                        duration: 500
                    }
                }]
              };
            this.fire('to-hashtag',e.detail);
          } else {
            this.fire('to-hashtag',e.detail);
          }
      },

      /**
      * 'toProfile' makes the app go to a new view/route (in this case sc-profile). The function sets the animationConfig and sharedElements, then fires 'to-profile' to the parent-element to change the route.
      */
      toProfile: function() {
        if (this.phoneview) {
          this.sharedElements = {
              'hero': this.$.homeavatar,
              'hero2': this.$.homeusername
            };

          this.animationConfig = {
                'entry': [{
                  name: 'fade-in-animation',
                  node:this.$.homebalance,
                  toPage: this,
                  timing: {
                    delay: 200,
                    duration: 125
                  },

                }, {
                  name: 'slide-from-bottom-animation',
                  node:this.$.bottomhalf,
                  toPage: this,
                  timing: {
                    duration: 700
                  }
                },{
                  name: 'hero-animation',
                  id: 'hero',
                  toPage: this,
                  timing: {
                      duration: 600
                    }
                }],

                'exit': [{
                  name: 'fade-out-animation',
                  node:this.$.homebalance,
                  fromPage: this,
                  timing: {
                      duration: 125
                  }
                },{
                  name: 'fade-out-animation',
                  node:this.$.homeusername,
                  fromPage: this,
                  timing: {
                      duration: 125
                  }
                }, {
                  name: 'slide-down-animation',
                  node:this.$.bottomhalf,
                  fromPage: this,
                  timing: {
                      duration: 700
                  }
                },{
                  name: 'hero-animation',
                  id: 'hero',
                  fromPage: this,
                  timing: {
                      duration: 600
                    }
                }]
            };
          this.fire('to-profile'); 
        } else {
          this.fire('to-profile'); 
        }
      },


      /**
      * 'toWalletview' makes the app go to a new view/route (in this case sc-walletview). The function sets the animationConfig and sharedElements, then fires 'to-walletview' to the parent-element to change the route.
      */
      toWalletview: function() {
        if (this.phoneview) {
        // TODO : remove this
        return;
        this.sharedElements = {
          'hero': this.$.homebalance,
          };
        this.animationConfig = {
              'entry': [{
                name: 'fade-in-animation',
                node:this.$.homebalance,
                toPage: this,
                timing: {
                  duration: 200
                }
              }, {
                name: 'fade-in-animation',
                node:this.$.homeusername,
                toPage: this,
                timing: {
                  duration: 200
                }
              },{
                name: 'hero-animation',
                id: 'hero',
                toPage: this,
                timing: {
                    duration: 600
                }
              }],

              'exit': [{
                name: 'fade-out-animation',
                node:this.$.homebalance,
                fromPage: this,
                timing: {
                    duration: 200
                }
              }, {
                name: 'fade-out-animation',
                node:this.$.homeusername,
                fromPage: this,
                timing: {
                    duration: 200
                }
              },{
                name: 'hero-animation',
                id: 'hero',
                fromPage: this,
                timing: {
                    duration: 600
                }
              }]
          };
        this.fire('to-walletview');

        } else {
        this.fire('to-walletview');
        }
      },




    });
  </script>
</dom-module>
