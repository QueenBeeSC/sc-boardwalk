<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">

<link rel="import" href="../../bower_components/sc-style/sc-style.html">
<link rel="import" href="../../bower_components/sc-iconset/sc-iconset.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">


<link rel="import" href="../sc-backbone/sc-backbone.html">
<link rel="import" href="../sc-loader/sc-loader.html">

<!-- note that this will be lazy-loaded -->
<!-- <link rel="import" href="../sc-boardwalk-app/sc-boardwalk-app.html"> -->

<!--
`sc-enter`

This is the homescreen of boardwalk.

@demo src/sc-enter/demo/index.html 
-->

<dom-module id="sc-enter">
<link rel="import" href="../../bower_components/sc-style/sc-style.css"  type="css">

  <template>
    <iron-localstorage name="sc-lastversionstarted"
      value="{{lastversionstarted}}"
      on-iron-localstorage-load-empty="initializeSC"
    ></iron-localstorage>  
    <app-location route="{{route}}" use-hash-as-path></app-location>  
    <sc-backbone id="backbone"></sc-backbone>
    <style>
      :host {
        display: block;
      }


      a {
        font-family: montserratlight;
        -webkit-font-smoothing: antialiased;
        font-weight: 100;

        font-size: 12px;
        font-weight: 300;
        line-height: 14px;
        -webkit-margin-before:4px;
        -webkit-margin-after:4px;
        -webkit-margin-start:0em;
        -webkit-margin-end:0em;
        margin:4px 0px 4px 0px;

        text-decoration: none;
        outline: none;
      }

      a:visited {
        text-decoration: none;
        outline: none;
      }

      .logotitle {
        text-align: left;
        font-size: 78px;
        line-height: 72px;
      }

      .welcometo {
        text-align: left;
        font-size: 48px;
        line-height: 50px;
      }

      .logoalign {
        box-sizing:border-box;
        padding-top: 14vh;
        padding-bottom: 20vh;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-end);
      }

      .inneralign {
        @apply(--layout-vertical);
        @apply(--layout-start-justified);
        @apply(--layout-start);
        @apply(--layout-flex);
      }

      .maintxt {
        font-size: 30px;
        line-height: 36px;
      }

      .maxwidthz {
        max-width:590px;
      }

      .enterbtn {
        background-color:rgba(255,255,255,0.1);
      }
      
      .linkblocks {
        padding-top: 10vh;
        padding-left: 10vw;
        padding-right: 10vw;
        padding-bottom: 8vh;
      }

      .linkblok_one {
        @apply(--layout-vertical);
        @apply(--layout-start-justified);
        @apply(--layout-start);
        @apply(--layout-flex);
        min-width:  300px;
      }

      .linkblok_two {
        @apply(--layout-vertical);
        @apply(--layout-start-justified);
        @apply(--layout-end);
        min-width:  300px;
        max-width:  500px;
        margin-top: 0px;
      }

      .linkblok_one a {
        color: var(--sc-blue);
        border-bottom: 1px dotted var(--sc-blue);
      }

      .linkblok_one a:visited {
        color: var(--sc-blue);
        border-bottom: 1px dotted var(--sc-blue);
      }

      .linkblok_two a {
        color: var(--sc-grey3);
        border-bottom: 1px dotted var(--sc-grey2);
      }

      .linkblok_two a:visited {
        color: var(--sc-grey3);
        border-bottom: 1px dotted var(--sc-grey2);
      }



      .whatitem {
        width: 230px;
        margin-top: 20px;
      }

      .whatitemimg {
        width: 90px;
        height: 90px;
        margin: 25px 0px 25px 0px;
        border-radius: 50%;
        overflow: hidden;
      }

      .whatitemimg img {
        width: 100%;
        height: 100%;
      }

      .loadingscreen {
        width: 100vw;
        height: 100vh;

      }

      .semiopacity {
        opacity: 0.15;
      }



    @media all and (min-width: 0px) and (max-width: 500px) {

      .logotitle {
        text-align: center;
        font-size: 44px;
        line-height: 42px;
      }


      .welcometo {
        text-align: center;
        font-size: 34px;
        line-height: 36px;
      }

      .logoalign {
        @apply(--layout-vertical);
        @apply(--layout-center-center);
        padding-top: 15vh;
        padding-bottom: 15vh;
      }

      .inneralign {
        @apply(--layout-vertical);
        @apply(--layout-center-center);
        -ms-flex: none;
        -webkit-flex: none;
        flex: none;
      }

      .maintxt {
        font-size: 30px;
        line-height: 36px;
      }
      
      .enterbtn {
        background-color:rgba(255,255,255,0.075);
        margin-top: 12vh;
      }

      .linkblocks {
        padding-top: 8vh;
        padding-left: 10vw;
        padding-right: 10vw;
        padding-bottom: 8vh;
      }

      .linkblok_one {
        @apply(--layout-vertical);
        @apply(--layout-start-justified);
        @apply(--layout-start);
       -ms-flex: none;
        -webkit-flex: none;
        flex: none;
      }

      .linkblok_two {
        @apply(--layout-vertical);
        @apply(--layout-start-justified);
        @apply(--layout-start);
        margin-top: 30px;
      }

      .whatitem {
        width: 300px;
        margin: 20px 0px 20px 0px;
      }

    }


    </style>

    <iron-media-query query="(min-width:0px) and (max-width: 420px)" query-matches="{{phoneview}}"></iron-media-query>

    <template is="dom-if" if="{{showLoader}}">
      This is the initial LOADER
    </template>
    
    <template is="dom-if" if="{{showStartScreen}}">

      <div class="totalwidth logoalign paddingsides yellowback">
        <div class="inneralign">
          <iron-icon icon="sc-icons:logonew" class="giant grey4 logoicon">Swarmcity-logo</iron-icon>
          <h1 class="welcometo">Welcome to</h1>
          <h1 class="bold grey4 logotitle">swarm.<template is="dom-if" if="{{!phoneview}}"><br></template>city</h1>
        </div>

        <paper-button on-tap="toggleapp" class="grey4 shadow enterbtn bigbtn" noink>enter here</paper-button>
        </div>
        <div class="totalwidth whiteback vertic centercenter paddingallround">
          <p class="centertxt ultralight maintxt grey3 maxwidthz">Swarm City is the first truly decentralized peer to peer sharing economy.</p>
          <div class="whitespace"></div>

          <div class="whatitems horizont start centerjust wrap">

            <div class="whatitem vertic center startjust">
              <div class="whatitemimg grey1back">
                <img src="./images/site_whatitem.png">
              </div>
              <p class="centertxt small reg grey5">Enabled by the SWT token, running<br>on the Ethereum blockchain</p>
              <div class="minispace"></div>
              <!-- <a class="morelink" target="_blank" href="https://swt.swarm.city">tell me more</a> -->
            </div>

            <div class="whatitem vertic center startjust">
              <div class="whatitemimg grey1back">
                <img src="./images/site_whatitem2.png">
              </div>
              <p class="centertxt small reg grey5">Stored locally on your device,<br>no central database</p>
              <div class="minispace"></div>
              <!-- <a class="morelink" target="_blank" href="https://thisis.swarm.city">tell me more</a> -->
            </div>

            <div class="whatitem vertic center startjust">
              <div class="whatitemimg grey1back">
                <img src="./images/site_whatitem3.png">
              </div>
              <p class="centertxt small reg grey5">It's an open source project,<br>so you can jump right in</p>
              <div class="minispace"></div>
              <a class="morelink" target="_blank" href="https://getactivein.swarm.city">tell me more</a>
            </div>

          </div>

        </div>
        <div class="totalwidth horizont wrap centerjust start linkblocks">
          <div class="linkblok_one">
            <!-- <a target="_blank" href="http://thisis.swarm.city">What is Swarm City?</a> -->
            <a target="_blank" href="https://getactivein.swarm.city">Get active in Swarm City</a>
            <!-- <a target="_blank" href="http://swt.swarm.city">About the Swarm City Token</a> -->
            <a target="_blank" href="https://advisors.swarm.city">Swarm City Advisors</a>
            <!-- <a target="_blank" href="http://dev.swarm.city">Development</a>
            <a target="_blank" href="http://releaseroadmap.swarm.city">Release Roadmap</a> -->
            <a target="_blank" href="https://faq.swarm.city">FAQ</a>
          </div>
          <div class="linkblok_two">
            <p class="bold grey3 small">Find Swarm City on</p>
            <div class="minispace"></div>
            <a href="https://swarm-slack-invite.herokuapp.com/" target="_blank">Slack</a>
            <a href="https://medium.com/swarm-city-times" target="_blank">Medium</a>
            <a href="https://github.com/swarmcity" target="_blank">Github</a>
            <a href="https://twitter.com/SwarmCityHive" target="_blank">Twitter</a>
            <a href="https://www.youtube.com/channel/UCsHBWn_ytZ3xdMbTyYe5Ifg" target="_blank">Youtube</a>
            <a href="https://www.facebook.com/groups/SwarmCity/" target="_blank">Facebook</a>
          </div>
        </div>
    </template>

    <template is="dom-if" if="{{showApp}}">
      <sc-boardwalk-app
        id="boardwalk"
        route="{{route}}"
        on-loaded="boardwalkReady"
        on-exit="onExit"
        ></sc-boardwalk-app>      
      <template is="dom-if" if="{{!boardwalkLoaded}}">
        <div class="loadingscreen grey4back horizont centercenter">
          <sc-loader color="yellow"></sc-loader>
        </div>
      </template>
    </template>

  </template>

  <script>
    Polymer({

      is: 'sc-enter',

      properties: {

        route: {
          type: Object,
          observer: '_onRouteDataChanged',
        },

        lastversionstarted: {
          type: String,
          observer: '_lastversionstarted'
        },
      },

      ready: function(){
        this.onEnter();
      },

      _onRouteDataChanged: function(page,oldpage) {
        if (!page){
          return;
        }
        console.log('sc-enter -> _onRouteDataChanged',oldpage,'->',page);
      },

      _isLocalhost: function(hostname) {
        // !! coerces the logical expression to evaluate to the values true or false.
        return !!(hostname === 'localhost' ||
                  // [::1] is the IPv6 localhost address.
                  hostname === '[::1]' ||
                  // 127.0.0.1/8 is considered localhost for IPv4.
                  hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));
      },      

      attached: function(){
        if (window.location.protocol === 'http:' && !this._isLocalhost(window.location.hostname)) {
          // Redirect to https: if we're currently using http: and we're not on localhost.
          window.location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        }else{
          this.$.backbone.lazyload('bundle-terminal');
        }        
      },

      /**
      * 'onEnter' are the behaviors that occur when the router tells this component enters the stage 
      * use this to initialize any variables to start the component
      */
      onEnter: function(){
        this.showStartScreen = false;
        this.showApp = false;
        this.showLoader = true;
        //this.showApp = !this.showStartScreen;
        this.boardwalkLoaded = false;
      },

      /**
      * 'onExit' are the behaviors that occur when the router tells this component to leave the stage 
      * use this to reset any variables when leaving this component while it remains loaded.
      */
      onExit: function(){
        this.showStartScreen = true;
      },

      boardwalkReady: function(){
        //debugger;
        this.boardwalkLoaded = true;
        //this.$.boardwalk.onEnter();
      },

      toggleapp: function(){
        this.showStartScreen = !this.showStartScreen;
        this.showApp = !this.showStartScreen;
      },

      // nothing has been loaded..
      initializeSC: function(){
        this.showStartScreen = true;
      },

      _lastversionstarted: function(){
        this.showApp = true;
        this.showLoader = false;
      }



    });
  </script>
</dom-module>
