<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">

<link rel="import" href="../../bower_components/sc-style/sc-style.html">
<link rel="import" href="../../bower_components/sc-iconset/sc-iconset.html">

<link rel="import" href="../sc-avatar/sc-avatar.html">
<link rel="import" href="../sc-username/sc-username.html">
<link rel="import" href="../sc-balance/sc-balance.html">
<link rel="import" href="../sc-hashtaglist/sc-hashtaglist.html">

<!--
`sc-home` is homeview of the Swarm City app. It shows your avatar/username/pubkey ( > to go to profile-view), your balance ( > to go to sc-wallet-view) and the hashtaglist ( > to go to a specific hashtag).

@demo src/sc-home/demo/index.html 
-->

<dom-module id="sc-home">
<link rel="import" href="../../bower_components/sc-style/sc-style.css"  type="css">

  <template>
    <style>
      :host {
        display: block;
        @apply(--base-structure);
      }

      .avatar_username_balance {
        @apply(--base-structure);
        width: 300px;
        box-sizing:border-box;
        padding: 15vh 0px 18vh 50px;
        height: 100%;
      }

      .avatar_username_box {
      }

      .homebalance_box {
      }

      sc-avatar {
        margin: 0px 0px 20px 0px;
      }

      sc-hashtaglist {
        background-color: none;
        box-sizing:border-box;
        padding: 15vh 0px 15vh 0px;
      }

      .warningbackup {
        margin-left: 10px;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid var(--sc-blue);
      }

    
      @media all and (min-width: 0) and (max-width: 420px) {

        .avatar_username_balance {
          height: 50vh;
          width: 100%;
          box-sizing:border-box;
          padding: 0px;
        }

        sc-hashtaglist {
          background-color: var(--sc-white);
          width: 100%;
          box-sizing:border-box;
          padding: 0px;
        }
      }


    </style>

    <iron-media-query query="(min-width:0px) and (max-width: 420px)" query-matches="{{phoneview}}"></iron-media-query>

    <div class="horizont start startjust wrap">
      <div class="avatar_username_balance vertic centercenter">
        <div class="avatar_username_box vertic centercenter" on-tap="toProfile">
          <sc-avatar
          identity="[[identity]]"
          pubkey="[[pubkey]]"
          id="homeavatar"
          ></sc-avatar>
          <div class="horizont centercenter">
            <sc-username
            identity="[[identity]]"
            pubkey="[[pubkey]]"
            id="homeusername"
            size="small"
            ></sc-username>
            <template is="dom-if" if="{{!lastbackup}}">
              <div class="warningbackup blue vertic centercenter"><p class="bold blue">!</p></div>
            </template>
          </div>
        </div>
        <div id="homebalance" class="homebalance_box" on-tap="toProfile">
          <sc-balance
            refcur="EUR"
            swtbalance="[[swtbalance]]"
            ethbalance="{{ethbalance}}"
            ></sc-balance>
        </div>
      </div>
      <sc-hashtaglist on-hashtag="toHashtag" id="bottomhalf"></sc-hashtaglist>
    </div>



  </template>

  <script>
    Polymer({

      is: 'sc-home',

      properties: {

        /**
       * `identity` is received from parent-element, as an object containing an IPFS-hash, which is img-source.
       */
        identity: {
          type: String,
          observer: '_identity',
          notify: true
        },

        /**
       * `web3` is received from parent-element.
       */
        web3: {
          type: Object
        },

        /**
       * `keystore` is received from parent-element.
       */
        keystore: {
          type: Object,
           observer: '_keystore',
        },

       //  /**
       // * `datachanged` .
       // */
       //  datachanged: {
       //    type: Boolean,
       //    value: false
       //  },

        /**
       * `sharedElements` is used to share elements between components for doing animations.
       */
        sharedElements: {
          type: Object,
          value: function() {
            return {
              'hero': '',
            }
          }
        },  

        /**
       * `animationConfig` is used to configure animations.
       */
        animationConfig: {
        },


        /**
       * `pubkey` is the Swarm Citizen's pubkey.
       */        
        pubkey: {
          type: String,
          observer: '_pubkey'
        },

      },

      behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior
      ],

      /**
      * 'onEnter' are the behaviors that occur when the router tells this component enters the stage 
      * use this to initialize any variables to start the component
      */
      onEnter: function(){
      },

      /**
      * 'onExit' are the behaviors that occur when the router tells this component to leave the stage 
      * use this to reset any variables when leaving this component while it remains loaded.
      */
      onExit: function(){
      },



      /**
      * 'exit' is fired when the x is tapped in sc-home.
      */
      exit: function(){
      },

      /**
      * '_pubkey' monitors is the pubkey changes to update the balance.
      */
      _pubkey: function(){
        if (this.pubkey){
          this.$.wallet.updateBalance();
        }
      },

      /**
      * '_identity' monitors is the identity changes.
      */
      _identity: function() {
        if (this.identity){
          this.currentavatar = this.identity.avatarurl;
        }
      },


      /**
      * 'toHashtag' makes the app go to a new view/route (in this case sc-hashtag). The function sets the animationConfig and sharedElements, then fires 'to-hashtag' to the parent-element to change the route.
      */
      toHashtag: function(e) {
        if (this.phoneview) {

          this.sharedElements = {
              'hero': this.$.homeavatar,
              'balance': this.$.homebalance
            };

          this.animationConfig = {
              'entry': [{
                  name: 'fade-in-animation',
                  node:this.$.homebalance,
                  toPage: this,
                  timing: {
                    delay: 200,
                    duration: 125
                  }
                },{
                  name: 'fade-in-animation',
                  node:this.$.homeusername,
                  toPage: this,
                  timing: {
                    delay: 475,
                    duration: 125
                  }
                }, {
                  name: 'slide-from-bottom-animation',
                  node:this.$.bottomhalf,
                  toPage: this,
                  timing: {
                    duration: 700
                  }
                },{
                  name: 'hero-animation',
                  id: 'hero',
                  toPage: this,
                  timing: {
                      duration: 500
                  }
                },{
                  name: 'hero-animation',
                  id: 'balance',
                  toPage: this,
                  timing: {
                      duration: 500
                  }
                }],

                'exit': [
                  {
                    name: 'fade-out-animation',
                    node:this.$.homeusername,
                    fromPage: this,
                    timing: {
                        duration: 200
                    }
                  }, {
                    name: 'fade-out-animation',
                    node:this.$.bottomhalf,
                    fromPage: this,
                    timing: {
                        duration: 200
                    }
                  },{
                    name: 'hero-animation',
                    id: 'hero',
                    fromPage: this,
                    timing: {
                        duration: 500
                    }
                  },{
                    name: 'hero-animation',
                    id: 'balance',
                    fromPage: this,
                    timing: {
                        duration: 500
                    }
                }]
              };
            this.fire('to-hashtag',e.detail);
          } else {
            this.fire('to-hashtag',e.detail);
          }
      },

      /**
      * 'toProfile' makes the app go to a new view/route (in this case sc-profile). The function sets the animationConfig and sharedElements, then fires 'to-profile' to the parent-element to change the route.
      */
      toProfile: function() {
        if (this.phoneview) {
          this.sharedElements = {
              'hero': this.$.homeavatar,
              'hero2': this.$.homeusername
            };

          this.animationConfig = {
                'entry': [{
                  name: 'fade-in-animation',
                  node:this.$.homebalance,
                  toPage: this,
                  timing: {
                    delay: 200,
                    duration: 125
                  },

                }, {
                  name: 'slide-from-bottom-animation',
                  node:this.$.bottomhalf,
                  toPage: this,
                  timing: {
                    duration: 700
                  }
                },{
                  name: 'hero-animation',
                  id: 'hero',
                  toPage: this,
                  timing: {
                      duration: 600
                    }
                }],

                'exit': [{
                  name: 'fade-out-animation',
                  node:this.$.homebalance,
                  fromPage: this,
                  timing: {
                      duration: 125
                  }
                },{
                  name: 'fade-out-animation',
                  node:this.$.homeusername,
                  fromPage: this,
                  timing: {
                      duration: 125
                  }
                }, {
                  name: 'slide-down-animation',
                  node:this.$.bottomhalf,
                  fromPage: this,
                  timing: {
                      duration: 700
                  }
                },{
                  name: 'hero-animation',
                  id: 'hero',
                  fromPage: this,
                  timing: {
                      duration: 600
                    }
                }]
            };
          this.fire('to-profile'); 
        } else {
          this.fire('to-profile'); 
        }
      },


      /**
      * 'toWalletview' makes the app go to a new view/route (in this case sc-walletview). The function sets the animationConfig and sharedElements, then fires 'to-walletview' to the parent-element to change the route.
      */
      toWalletview: function() {
        if (this.phoneview) {
        // TODO : remove this
        return;
        this.sharedElements = {
          'hero': this.$.homebalance,
          };
        this.animationConfig = {
              'entry': [{
                name: 'fade-in-animation',
                node:this.$.homebalance,
                toPage: this,
                timing: {
                  duration: 200
                }
              }, {
                name: 'fade-in-animation',
                node:this.$.homeusername,
                toPage: this,
                timing: {
                  duration: 200
                }
              },{
                name: 'hero-animation',
                id: 'hero',
                toPage: this,
                timing: {
                    duration: 600
                }
              }],

              'exit': [{
                name: 'fade-out-animation',
                node:this.$.homebalance,
                fromPage: this,
                timing: {
                    duration: 200
                }
              }, {
                name: 'fade-out-animation',
                node:this.$.homeusername,
                fromPage: this,
                timing: {
                    duration: 200
                }
              },{
                name: 'hero-animation',
                id: 'hero',
                fromPage: this,
                timing: {
                    duration: 600
                }
              }]
          };
        this.fire('to-walletview');

        } else {
        this.fire('to-walletview');
        }
      },




    });
  </script>
</dom-module>
